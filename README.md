# ToGather

### **일정 조율 시스템 설계**

---

### **핵심 개요**
- **목적**: 대학생 팀플, 동아리 모임, 미팅 등에서 일정 조율과 장소 선택을 간편하게 관리.
- **주요 기능**:
  - 가능한 날짜/시간 선택 및 투표.
  - 참여자의 출발지점을 기반으로 중간지점 추천.
  - 장소(카페, 합주실, 음식점 등) 표시.
  - QR 코드, 링크, 또는 코드를 활용한 이벤트 참여.
  - TIME ZONE이 다를 시 시차를 선택하여 조회

---

### **기능 상세**

#### **1. 첫 페이지 구성**
- **영역 구분**: 
  1. **참여하기**: 링크/코드/QR로 이벤트에 참여 후 일정 투표.
  2. **이벤트 생성하기**: 날짜/시간 범위를 설정하고 투표 화면으로 연결.
  
#### **2. 일정 투표 기능**
- **날짜 및 시간 선택**:
  - 최대 14일까지 선택 가능.
  - 시간/날짜 중복 선택 허용.
- **빠른 선택 옵션 제공**:
  - "이번 주말", "평일 저녁" 등 사용자 맞춤 패턴 추가.
- **참여 상황 표시**:
  - 가장 인기 있는 옵션 강조.
  - 사용자가 선택한 옵션 시각적으로 구분.

#### **3. 장소 추천 및 지도 표시**
- **중간 지점 계산**:
  - 참여자들의 출발지점 기반으로 중간 좌표 계산.
- **장소 표시**:
  - 중간지점 근처 카페, 합주실, 음식점 등을 지도에 핀으로 표시.
  - 카카오 지도 API를 활용.

#### **4. 이벤트 참여 및 공유**
- **이벤트 생성 완료 후**:
  - "이벤트 링크 복사" 버튼 제공.
  - 카카오톡, 이메일, 메신저로 공유 가능.
- **QR 코드 제공**:
  - 링크를 QR 코드로 생성해 간편 공유.
- **코드 유효성 검증**:
  - 이벤트 코드가 유효하지 않을 경우 즉시 알림.

#### **5. 커뮤니케이션 및 마감 관리**
- **참여자 소통 기능**:
  - 간단한 메시지 게시판 추가.
  - 예: "A 합주실 18-20시 예약했습니다."
- **응답 마감 시간 설정**:
  - 이벤트 생성자가 투표 마감 시간 설정 가능.
  - 마감 후 인기 있는 옵션 자동 선택 (예외 가능).

#### **6. 반응형 UI**
- **화면 최적화**:
  - PC 우선

---

### **기술 스택 및 도구**
1. **프론트엔드**:
   - UI 라이브러리: **FullCalendar.js** (날짜/시간 선택)
   - 지도 API: **카카오 지도 API** (중간지점 추천 및 장소 표시).
2. **백엔드**:
   - **Spring**
   - 데이터베이스: **PostgreSQL**.
3. **공유 기능**:
   - **QR 코드 라이브러리**: `qrcode.js` (링크를 QR 코드로 생성).

---

### **사용자 흐름 요약**
1. **첫 페이지**:
   - "참여하기" 또는 "이벤트 생성하기" 선택.
2. **참여하기**:
   - 링크/코드/QR 입력 → 유효성 확인 → 투표 화면으로 이동.
3. **이벤트 생성하기**:
   - 날짜/시간 범위 설정 → 생성 완료 → 링크/QR 제공 → 투표 화면 이동.
4. **투표 화면**:
   - 가능한 시간 선택 및 제출.
   - 참여 상황을 히트맵으로 시각화.
5. **결과 페이지**:
   - 최다 선택 시간/장소 표시.
   - 중간지점 근처 장소 추천 및 지도 핀 표시.

---

### **개선 포인트**
- **확장성**: 장소 추천 기능에 필터(예: "조용한 카페" 또는 "넓은 공간") 추가 가능.

---

## **1. 데이터베이스 설계**
### **a. 테이블 설계**

#### **기본 테이블 구조**
1. **Event Table**: 이벤트에 대한 기본 정보를 저장.
   - `event_id`: 고유 식별자 (Primary Key).
   - `event_name`: 이벤트 이름.
   - `created_by`: 이벤트 생성자.
   - `created_at`: 생성 날짜.

2. **Participants Table**: 이벤트에 참여하는 사용자 정보를 저장.
   - `participant_id`: 고유 식별자.
   - `event_id`: `Event` 테이블과 연결.
   - `user_id`: 사용자 고유 ID.
   - `user_password`: 사용자 고유 password.

---

### **b. 데이터 샘플**
#### **Event Table**
| event_id | event_name   | created_by | created_at          |
|----------|--------------|------------|---------------------|
| 1        | Team Meeting | user123    | 2024-11-19 10:00:00 |


#### **Participants Table**
| participant_id | event_id | user_id  | user_password |
|----------------|----------|----------|----------|
| 1              | 1        | user456  |4522      |

---
이해했습니다! 말씀하신 구조는 히트맵을 **날짜를 기준으로 열(Column)**로 하고, **시간을 기준으로 행(Row)**으로 구성하는 것입니다. 이 히트맵은 사용자가 30분 단위로 선택할 수 있게 하고, 선택 횟수에 따라 색상이 짙어지는 형태로 설계할 수 있습니다.

---

## **구현 계획**

1. **히트맵 기본 구조**
   - **X축(열)**: 사용자가 선택한 가능한 날짜(예: `11/22`, `11/23`, `11/25`).
   - **Y축(행)**: 시간 범위(예: `10:00`, `10:30`, ... `17:00`).
   - 히트맵의 각 셀은 특정 날짜-시간 조합을 나타냅니다.

2. **데이터 초기화**
   - 각 셀의 초기값은 `0`(선택 없음).
   - 사용자가 선택할 때마다 해당 셀의 값을 증가시킴.

3. **히트맵 UI**
   - 셀의 색상은 선택 횟수에 따라 점점 짙어지도록 설정.
   - JavaScript 라이브러리인 **ApexCharts**를 사용하여 구현.

4. **사용자 선택 저장**
   - 사용자가 클릭한 셀의 날짜-시간 정보를 서버에 전송.
   - 다른 사용자의 선택이 반영된 데이터로 히트맵을 실시간 업데이트.

---

## **코드 예제**

### **1. HTML 구조**

```html
<div id="heatmap"></div>
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
```

---

### **2. JavaScript: 히트맵 생성**

```javascript
// 선택한 날짜와 시간 범위 (예제 데이터)
const selectedDates = ["11/22", "11/23", "11/25"]; // X축
const timeRange = ["10:00", "10:30", "11:00", "11:30", "12:00", "12:30", "13:00", "13:30", "14:00", "14:30", "15:00", "15:30", "16:00", "16:30", "17:00"]; // Y축

// 히트맵 데이터 초기화
const heatmapData = timeRange.map(time => ({
    name: time, // Y축 라벨
    data: selectedDates.map(date => ({ x: date, y: 0 })) // X축 데이터
}));

// ApexCharts 설정
const options = {
    chart: {
        type: "heatmap",
        height: 450,
        events: {
            click: function(event, chartContext, config) {
                // 클릭한 셀 정보 가져오기
                const { seriesIndex, dataPointIndex } = config;

                if (seriesIndex !== undefined && dataPointIndex !== undefined) {
                    // 선택된 셀의 데이터 업데이트
                    const time = heatmapData[seriesIndex].name;
                    const date = heatmapData[seriesIndex].data[dataPointIndex].x;
                    heatmapData[seriesIndex].data[dataPointIndex].y += 1; // 선택 횟수 증가

                    // 히트맵 업데이트
                    chart.updateSeries(heatmapData);

                    console.log(`선택된 시간: ${time}, 날짜: ${date}`);
                }
            }
        }
    },
    plotOptions: {
        heatmap: {
            shadeIntensity: 0.5,
            colorScale: {
                ranges: [
                    { from: 0, to: 1, name: "Low", color: "#D6EAF8" },
                    { from: 2, to: 3, name: "Medium", color: "#5DADE2" },
                    { from: 4, to: 5, name: "High", color: "#154360" }
                ]
            }
        }
    },
    dataLabels: {
        enabled: true,
        style: {
            colors: ["#fff"]
        }
    },
    series: heatmapData,
    xaxis: {
        type: "category",
        title: {
            text: "날짜"
        }
    },
    yaxis: {
        title: {
            text: "시간"
        }
    },
    title: {
        text: "시간-날짜 히트맵",
        align: "center"
    }
};

// 히트맵 렌더링
const chart = new ApexCharts(document.querySelector("#heatmap"), options);
chart.render();
```

---

### **3. 설명**

1. **데이터 초기화**
   - 각 시간 범위와 날짜의 조합을 기반으로 히트맵 데이터를 생성.
   - 초기값(`y`)은 `0`.

2. **셀 클릭 이벤트**
   - 사용자가 셀을 클릭하면 선택 횟수(`y`)를 증가시킴.
   - `chart.updateSeries()`를 사용해 히트맵을 동적으로 업데이트.

3. **색상 설정**
   - `plotOptions.heatmap.colorScale.ranges`에서 선택 횟수(`y` 값)에 따라 색상을 정의.

---

### **4. 결과**
- X축: 선택한 날짜(`11/22`, `11/23`, `11/25`).
- Y축: 시간 범위(`10:00` ~ `17:00`).
- 각 셀:
  - 초기값: `0` (회색).
  - 선택 횟수 증가 시 색상이 점점 짙어짐(밝은 파랑 → 어두운 파랑).

---

### **추가 작업**

1. **데이터 서버 저장**
   - 사용자가 셀을 클릭할 때 AJAX 요청으로 선택 데이터를 서버에 저장.
   - 서버에서 전체 데이터를 가져와 히트맵 업데이트.

2. **실시간 업데이트**
   - WebSocket 또는 주기적인 데이터 요청(AJAX)으로 다른 사용자의 선택을 실시간 반영.

3. **UI 개선**
   - 날짜 범위 필터링 기능 추가.
   - 셀 선택 시 툴팁에 세부 정보 표시.

위 코드를 기반으로 구현을 진행하면서 추가적인 요구사항이 있다면 언제든 말씀해주세요! 😊

